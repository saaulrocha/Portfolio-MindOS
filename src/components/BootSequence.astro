---
// BootSequence component - Cinematic boot animation
import { profile } from "../data/profile";
---

<div
  id="boot-screen"
  class="fixed inset-0 z-[200] bg-os-bg flex flex-col items-center justify-center"
>
  <!-- Center Logo -->
  <div
    class="boot-logo mb-12 opacity-0"
    style="animation: fade-in 1s ease-out 0.3s forwards"
  >
    <div class="w-28 h-28 flex items-center justify-center">
      <img
        src="/LogoMindOS-removebg-preview.png"
        alt="MindOS"
        class="w-full h-full object-contain drop-shadow-2xl"
      />
    </div>
  </div>

  <!-- Terminal Output -->
  <div class="w-full max-w-lg px-8 font-mono text-sm space-y-1.5 mb-8">
    <p class="boot-line opacity-0 text-os-accent" style="animation-delay: 0.5s">
      MindOS v2.0.0 — Mental Operating System
    </p>
    <p
      class="boot-line opacity-0 text-os-text-muted"
      style="animation-delay: 0.8s"
    >
      © 2024 {profile.name}
    </p>
    <p class="boot-line opacity-0" style="animation-delay: 1.2s">&nbsp;</p>
    <p
      class="boot-line opacity-0 text-os-text-secondary"
      style="animation-delay: 1.4s"
    >
      <span class="text-os-text-muted">[</span>BOOT<span
        class="text-os-text-muted">]</span
      > Initializing kernel...
    </p>
    <p
      class="boot-line opacity-0 text-os-success"
      style="animation-delay: 1.8s"
    >
      <span class="text-os-text-muted">[</span>OK<span
        class="text-os-text-muted">]</span
      > Kernel: {profile.name}
    </p>
    <p
      class="boot-line opacity-0 text-os-text-secondary"
      style="animation-delay: 2.2s"
    >
      <span class="text-os-text-muted">[</span>BOOT<span
        class="text-os-text-muted">]</span
      > Loading memory...
    </p>
    <p
      class="boot-line opacity-0 text-os-success"
      style="animation-delay: 2.6s"
    >
      <span class="text-os-text-muted">[</span>OK<span
        class="text-os-text-muted">]</span
      > 42 Madrid loaded
    </p>
    <p
      class="boot-line opacity-0 text-os-text-secondary"
      style="animation-delay: 3.0s"
    >
      <span class="text-os-text-muted">[</span>BOOT<span
        class="text-os-text-muted">]</span
      > Starting processes...
    </p>
    <p
      class="boot-line opacity-0 text-os-success"
      style="animation-delay: 3.4s"
    >
      <span class="text-os-text-muted">[</span>OK<span
        class="text-os-text-muted">]</span
      > All systems ready
    </p>
    <p class="boot-line opacity-0" style="animation-delay: 3.8s">&nbsp;</p>
    <p
      class="boot-line opacity-0 text-os-accent font-medium terminal-cursor"
      style="animation-delay: 4.2s"
    >
      Welcome to MindOS
    </p>
  </div>

  <!-- Progress Bar -->
  <div
    class="w-64 h-1 bg-os-surface rounded-full overflow-hidden opacity-0"
    style="animation: fade-in 0.5s ease-out 0.5s forwards"
  >
    <div
      id="boot-progress"
      class="h-full progress-bar"
      style="animation: progress-fill 4.5s ease-out forwards"
    >
    </div>
  </div>

  <!-- Skip Hint -->
  <button
    id="skip-boot"
    class="mt-8 text-os-text-muted text-xs hover:text-os-text transition-colors font-mono opacity-0 flex items-center gap-2"
    style="animation: fade-in 0.5s ease-out 2.5s forwards"
  >
    <span class="px-1.5 py-0.5 rounded bg-os-surface text-[10px]">ESC</span>
    <span>Skip intro</span>
  </button>
</div>

<style>
  .boot-line {
    animation: boot-line 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }

  @keyframes boot-line {
    from {
      opacity: 0;
      transform: translateX(-8px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
</style>

<script>
  const bootScreen = document.getElementById("boot-screen");
  const skipBtn = document.getElementById("skip-boot");

  function hideBootScreen() {
    if (bootScreen && !bootScreen.classList.contains("hiding")) {
      bootScreen.classList.add("hiding");
      bootScreen.style.transition =
        "opacity 0.6s cubic-bezier(0.16, 1, 0.3, 1)";
      bootScreen.style.opacity = "0";
      setTimeout(() => {
        bootScreen.style.display = "none";
      }, 600);
    }
  }

  // Check if already booted in this session
  if (sessionStorage.getItem("mindos_booted")) {
    // Skip boot animation
    if (bootScreen) {
      bootScreen.style.display = "none";
    }
  } else {
    // Auto-hide after boot completes
    setTimeout(() => {
      hideBootScreen();
      sessionStorage.setItem("mindos_booted", "true");
    }, 5500);
  }

  // Skip on click
  skipBtn?.addEventListener("click", () => {
    hideBootScreen();
    sessionStorage.setItem("mindos_booted", "true");
  });

  // Skip on ESC key
  document.addEventListener(
    "keydown",
    (e) => {
      if (e.key === "Escape") {
        hideBootScreen();
        sessionStorage.setItem("mindos_booted", "true");
      }
    },
    { once: true },
  );
</script>
